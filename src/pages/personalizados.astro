---
import { fetchMatrizFlexible } from "../services/sheetService";
import DashboardLayout from "../layouts/DashboardLayout.astro";
import DayTabs from "../components/DayTabs.astro";
import HorarioTable from "../components/HorarioTable.astro";
import type { ScheduleItem } from "../features/schedule/types";
import { filterPersonalizedSchedule } from "../features/schedule/filters";

// Fetch data
const allData = (await fetchMatrizFlexible()) as ScheduleItem[];

// Filter only personalized sessions (Tipo === "Asesoría Personalizada")
const personalizedData = filterPersonalizedSchedule(allData);

const currentDay = null;
---

<DashboardLayout title="Asesorías Personalizadas - HorariosQuedate">
    <div class="relative min-h-screen flex flex-col">
        <!-- Title Section -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-[var(--color-text-main)]">
                Asesorías Personalizadas
            </h1>
            <p class="text-gray-500 dark:text-gray-400">
                Vista de todas las asesorías personalizadas
            </p>
        </div>

        <!-- Day Tabs -->
        <DayTabs activeDay={currentDay} />

        <!-- Results Count -->
        <div class="mb-4 text-sm text-gray-500 dark:text-gray-400">
            Mostrando <span class="font-bold text-[var(--color-brand)]"
                >{personalizedData.length}</span
            > asesorías personalizadas
        </div>

        <!-- Table -->
        <div class="flex-1">
            <HorarioTable data={personalizedData} />
        </div>
    </div>
</DashboardLayout>

<script>
    import { requireAuth } from "../services/authService";

    // Unified route guard: redirect unauthenticated users to login flow
    requireAuth();
</script>
